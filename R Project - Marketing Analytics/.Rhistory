library(data.table) # library to use data.table objects
library(stargazer)
library(ggplot2)
dt.em <- fread("20210412-email-campaign.csv")
str(dt.em)
cat("\n Numerical Variables Summary Table\n")
dt.em.predictors = dt.em[, list(last_purchase, hist_spend, books, electronics, pop_density, new_customer, device)]
stargazer(dt.em.predictors, type="text")
cat("\n Categorical Variables Summary Table\n\n")
summary(dt.em.predictors[, list(pop_density, device)])
# check device mode
qplot(factor(device), fill=factor(device), data=dt.em, geom="bar") +
labs(title = "Device Mode is Laptop and Mobile",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Device", y = "", fill="Device")
qplot(factor(pop_density), fill=factor(pop_density), data=dt.em, geom="bar") +
labs(title = "Population Density Mode is Sub-Urban",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Population Density", y = "", fill="Population Density")
ggplot(data=dt.em, aes(factor(last_purchase), fill=factor(new_customer))) +
geom_bar(position="dodge") + labs(title = "Months since last purchase per Customer",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "(Months since) Last Purchase", y = "", fill="New Customer")
ggplot(data=dt.em, aes(hist_spend, fill = factor(new_customer))) + geom_histogram(alpha = 1, position = "identity") +
labs(title = "Historical Spending Histogram per New Customer",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "(Last year's) Historical Spending", y = "", fill="New Customer")
ggplot(data=dt.em, aes(hist_spend)) + geom_histogram(alpha = 1, position = "identity") + facet_wrap(~ new_customer) +
labs(title = "Historical Spending Histogram per New Customer",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "(Last year's) Historical Spending", y = "", fill="New Customer")
ggplot(data=dt.em, aes(log(hist_spend), fill = factor(new_customer))) + geom_histogram(alpha = 1, position = "identity") +
labs(title = "Log of Historical Spending Histogram per New Customer",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Log of (Last year's) Historical Spending", y = "", fill="New Customer")
ggplot(data=dt.em, aes(log(hist_spend)))+ geom_histogram(alpha = 1, position = "identity") + facet_wrap(~ new_customer) +
labs(title = "Log of Historical Spending Histogram per New Customer",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Log of (Last year's) Historical Spending", y = "", fill="New Customer")
qplot(factor(new_customer), hist_spend, data=dt.em, fill=factor(new_customer), geom="boxplot") + facet_grid(~ books) +
labs(title = "Books",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "New Customer", y = "Historical Spending", fill="New Customer")
qplot(factor(new_customer), hist_spend, data=dt.em, fill=factor(new_customer), geom="boxplot") + facet_grid(~ electronics) +
labs(title = "Electronics",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "New Customer", y = "Historical Spending", fill="New Customer")
ggplot(dt.em, aes(x=factor(new_customer), y=hist_spend, fill=factor(new_customer))) + geom_boxplot() + facet_grid(~ books + electronics) +
labs(title = "Books & Electronics",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "New Customer", y = "Historical Spending", fill="New Customer")
t.test(dt.em$new_customer ~ dt.em$books)
t.test(dt.em$new_customer ~ dt.em$electronics)
lm.books.eletronics = lm(new_customer ~ books + electronics, data=dt.em)
summary(lm.books.eletronics)
mfit = lm(new_customer ~ last_purchase + hist_spend + books + electronics + pop_density + device,
data=dt.em)
summary(mfit)
library(GGally)
ggpairs(dt.em[, list(last_purchase, hist_spend, books, electronics, pop_density, device)])
qplot(factor(new_customer), fill=factor(new_customer), data=dt.em, geom="bar")+ facet_grid(~ books + electronics) +
labs(title = "The majority of customers buy either Books or Electronics",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "New Customer", y = "", fill="New Customer")
stargazer(dt.em , type = "text")
dt.em[treatment != "Books Email", t.test(last_purchase ~ treatment)]
dt.em[treatment != "Books Email", t.test(hist_spend ~ treatment)]
dt.em[treatment != "Books Email", t.test(books ~ treatment)]
dt.em[treatment != "Books Email", t.test(electronics ~ treatment)]
dt.em[treatment != "Books Email", t.test(new_customer ~ treatment)]
dt.em[treatment != "Books Email", t.test(visit_after ~ treatment)]
dt.em[treatment != "Books Email", t.test(purchased_after ~ treatment)]
dt.em[treatment != "Books Email", t.test(spend_after ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(last_purchase ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(hist_spend ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(books ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(electronics ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(new_customer ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(visit_after ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(purchased_after ~ treatment)]
dt.em[treatment != "Electronics Email", t.test(spend_after ~ treatment)]
dt.em[treatment != "No Email", t.test(last_purchase ~ treatment)]
dt.em[treatment != "No Email", t.test(hist_spend ~ treatment)]
dt.em[treatment != "No Email", t.test(books ~ treatment)]
dt.em[treatment != "No Email", t.test(electronics ~ treatment)]
dt.em[treatment != "No Email", t.test(new_customer ~ treatment)]
dt.em[treatment != "No Email", t.test(visit_after ~ treatment)]
dt.em[treatment != "No Email", t.test(purchased_after ~ treatment)]
dt.em[treatment != "No Email", t.test(spend_after ~ treatment)]
by.treatment = dt.em[, list(Total_Visit_after=sum(visit_after),
Total_Purchased_after=sum(purchased_after),
Total_Spend_after=sum(spend_after)), by="treatment"]
ggplot(data=by.treatment, aes(x=factor(treatment), y=Total_Visit_after, fill=factor(treatment))) +
geom_bar(stat="identity", position=position_dodge())+
geom_text(aes(label=Total_Visit_after), vjust=1.6, color="white",
position = position_dodge(0.9), size=3.5) + ggtitle("Total Number of Visitors 4 weeks after Treatment") +
labs(title = "Total Visitors 4 weeks after Treatment",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Total Visits After", fill="Treatment")
ggplot(data=by.treatment, aes(x=factor(treatment), y=Total_Purchased_after, fill=factor(treatment))) +
geom_bar(stat="identity", position=position_dodge())+
geom_text(aes(label=Total_Purchased_after), vjust=1.6, color="white",
position = position_dodge(0.9), size=3.5) + ggtitle("Total Number of Purchases 4 weeks after Treatment") +
labs(title = "Total Purchases 4 weeks after Treatment",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Total Purchased After", fill="Treatment")
ggplot(data=by.treatment, aes(x=factor(treatment), y=Total_Spend_after, fill=factor(treatment))) +
geom_bar(stat="identity", position=position_dodge())+
geom_text(aes(label=Total_Spend_after), vjust=1.6, color="white",
position = position_dodge(0.9), size=3.5) + ggtitle("Total Spending 4 weeks after Treatment") +
labs(title = "Total Spending 4 weeks after Treatment",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Total Spend After", fill="Treatment")
# No email
n_customer_no = length(dt.em[treatment=="No Email", new_customer])
total_no_spend = dt.em[treatment=="No Email", sum(spend_after)]
no_spend_per_customer = total_no_spend/n_customer_no
percent_no = sum(dt.em[treatment == "No Email" , sum(spend_after)])/sum(dt.em$spend_after)*100
n_customer_b = length(dt.em[treatment=="Books Email", new_customer])
total_books_spend = dt.em[treatment=="Books Email", sum(spend_after)]
books_spend_per_customer = total_books_spend/n_customer_b
percent_books = sum(dt.em[treatment == "Books Email" , sum(spend_after)])/sum(dt.em$spend_after)*100
cat("\nThe books version of the campaign yielded an incremental ", books_spend_per_customer-no_spend_per_customer, "€ per customer. With ", n_customer_b, " customers spending ", total_books_spend, "€. Which equates to ", percent_books,"% of the total sales 4 weeks after the experiment\n")
n_customer_el = length(dt.em[treatment=="Electronics Email", new_customer])
total_electronics_spend = dt.em[treatment=="Electronics Email", sum(spend_after)]
electronics_spend_per_customer = total_electronics_spend/n_customer_el
percent_electronics = sum(dt.em[treatment == "Electronics Email" , sum(spend_after)])/sum(dt.em$spend_after)*100
cat("\nThe Electronics version of the campaign yielded an incremental ", electronics_spend_per_customer-no_spend_per_customer, "€ per customer. With ", n_customer_el, " customers spending ", total_electronics_spend, "€. Which equates to ", percent_electronics,"% of the total sales 4 weeks after the experiment")
treatment = c("Books Email","Electronics Email", "No Email")
values = c(books_spend_per_customer-no_spend_per_customer, electronics_spend_per_customer-no_spend_per_customer, no_spend_per_customer-no_spend_per_customer)
data = data.frame(treatment, values)
ggplot(data=data, aes(x=factor(treatment), y=values, fill=factor(treatment))) +
geom_bar(stat="identity", position=position_dodge())+
geom_text(aes(label=values), vjust=1.6, color="white",
position = position_dodge(0.9), size=3.5) + ggtitle("Total Spending 4 weeks after Treatment") +
labs(title = "Incremental Spending per Treatment per customer, No Email as baseline",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Spend After per Customer", fill="Treatment")
new.data = dt.em[, list(Total_Spend_after=sum(spend_after)), by=c("treatment","books","electronics","device","pop_density","new_customer")]
labels_x = c("Books\nEmail"," Elect.\nEmail","No\nEmail")
ggplot(data=new.data, aes(x=factor(device), y=Total_Spend_after, fill=factor(treatment))) + #scale_x_discrete(labels=labels_x) +
geom_bar(stat="identity", position=position_dodge()) + facet_grid(~ books + electronics) +
labs(title = "Total Spending 4 weeks after Treatment",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Total Spend After", fill="Treatment")
ggplot(data=new.data, aes(x=factor(pop_density), y=Total_Spend_after, fill=factor(treatment))) + #scale_x_discrete(labels=labels_x) +
geom_bar(stat="identity", position=position_dodge()) + facet_grid(~ books + electronics) +
labs(title = "Total Spending 4 weeks after Treatment",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Total Spend After", fill="Treatment")
ggplot(data=new.data, aes(x=factor(new_customer), y=Total_Spend_after, fill=factor(treatment))) + #scale_x_discrete(labels=labels_x) +
geom_bar(stat="identity", position=position_dodge()) + facet_grid(~ books + electronics) +
labs(title = "Total Spending 4 weeks after Treatment",
#subtitle = "Plot of length by dose",
#caption = "Data source: ToothGrowth",
x = "Treatment", y = "Total Spend After", fill="Treatment")
